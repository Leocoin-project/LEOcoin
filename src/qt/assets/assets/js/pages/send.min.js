var sendPage=function(n){"use strict";function e(e){if(e)2==e.at&&""===n("#send-balance .pay_to").val()&&(n("#send-balance .pay_to").val(e.address).change(),n("#send-balance .pay_to").data("address",e.address));else{var t=n("#send-balance .pay_to").data("address");t&&(n("#send-balance .pay_to").val(t),n("#send-balance .pay_to").change())}return!0}function t(e){void 0===e&&(e=n(".show-coin-control").hasClass("active")),n("#coincontrol").toggle(e)}function i(){return n("div.recipient").length}function o(){n("#recipients").append(((0==i()?"":"<hr />")+d.replace(/recipient-template/g,"recipient[count]")).replace(/\[count\]/g,++u)),n("#amount"+u.toString()).on("keydown",unit.keydown).on("paste",unit.paste),bridge.userAction(["clearRecipients"]),n("#recipient"+u.toString()+" [data-title]").tooltip()}function a(){n("#recipients").html(""),n("#send-balance .amount").val("0").change(),o(),e()}function r(){function e(e,t){void 0!=t&&n.isNumeric(t)||(t=1);var i=chainDataPage.anonOutputs[e];return i?Math.min(i&&i.owned_mature>=t&&i.system_mature>=o&&i.system_mature,a):0}function t(n,i,o){switch(n){case 0:return o;case 2:return e(1*i,2)||t(++n,i,o);case 6:return Math.min(e(5*i,1),e(1*i,1))||t(++n,i,o);case 7:return Math.min(e(4*i,1),e(3*i,1))||t(++n,i,o);case 8:return Math.min(e(5*i,1),e(3*i,1))||t(++n,i,o);case 9:return Math.min(e(5*i,1),e(4*i,1))||t(++n,i,o);default:if(10==n)return e(i/2,2);o=Math.max(e(n*i,1),e(1*i,n))||t(1==n?3:++n,i,o)}return o}function i(){var i=1,r=0,c=n(this).find(".amount"),s=unit.parse(c.val(),n(this).find(".unit").val());for(n("[name=err"+c.attr("id")+"]").remove();s>=i&&a>=o;){r=parseInt(s/i%10);try{a=t(r,i,a)}catch(n){console.log(n)}finally{a||(a=e(r*i)),i*=10}}if(a<o)return invalid(c),c.parent().before("<div name='err"+c.attr("id")+"' class='warning'>Not enough system and or owned outputs for the requested amount. Only <b>"+a+"</b> anonymous outputs exist for coin value: <b>"+unit.format(r*(i/10),n(this).find(".unit"))+"</b></div>"),c.on("change",function(){n("[name=err"+c.attr("id")+"]").remove()}),n("#tx_ringsize").show(),void n("#suggest_ring_size").show()}chainDataPage.updateAnonOutputs();var o=bridge.info.options.MinRingSize||3,a=bridge.info.options.MaxRingSize||32;n("#send-balance").is(":visible")?n("#send-balance").each(i):n("div.recipient").each(i),n("#ring_size").val(a)}function c(t){var i=n("#send-main").is(":visible"),o=n("[name=transaction_type_from]:checked").val(),a=n("[name=transaction_type_to  ]:checked").val(),r=s();n("#spend_sdc").toggle("public"===o),n("#spend_LEOcoin").toggle("private"===o),n("#to_sdc").toggle("public"===a),n("#to_LEOcoin").toggle("private"===a),n("#to_balance").toggle(!i),n(".show-coin-control").toggle(l()<1),sendPage.toggleCoinControl(l()<0);var c=n(".show-advanced-controls").hasClass("active");n("#add_recipient").toggle(n("#send-main").is(":visible")&&c),n(".advanced_controls").toggle(c),n("#tx_ringsize,#suggest_ring_size").toggle((!bridge.info.options||1!=bridge.info.options.AutoRingSize)&&r>1&&c),c||i||e(),n("#coincontrol").is(":visible")||(n(".show-coin-control").removeClass("active"),n(".show-coin-control").removeClass("submit"),n(".show-coin-control").addClass("reset"))}function s(){var e="public"===n("[name=transaction_type_from]:checked").val(),t="public"===n("[name=transaction_type_to  ]:checked").val();return e?+!t:2+t}function l(){var e="public"===n("[name=transaction_type_from]:checked").val();return e?+!e:2+e}var d=n("#recipient-template")[0].outerHTML,u=0;return n("#recipient-template").remove(),window.addEventListener("tabChanged",function(e){if(n("#send").is(":visible")){var t=n(".show-advanced-controls").hasClass("active");n("#add_recipient").toggle(n("#send-main").is(":visible")&&t)}},!1),{init:function(){t(!1),o(),c(),n("#send [name^=transaction_type]").on("change",c),n("#send [data-toggle=tab]").on("shown.bs.tab",c)},initSendBalance:e,toggleCoinControl:t,addRecipient:o,addRecipientDetail:function(e,t,i,o){a(),n("#recipient"+u.toString()+" .pay_to").val(e).change(),n("#recipient"+u.toString()+" .pay_to_label").val(t).change(),n("#recipient"+u.toString()+" .amount").val(o).change(),n("#recipient"+u.toString()+" .narration").val(i).change(),n("[href=#send]").click()},clearRecipients:a,removeRecipient:function(e){i()<=1?a():(0==(e=n(e)).next("hr").remove().length&&e.prev("hr").remove(),e.remove(),n("#tooltip").remove())},suggestRingSize:r,sendCoins:function(){function e(){var e=n(this).find(".pay_to"),o=n(this).find(".amount");if(i=i&&invalid(e,bridge.validateAddress(e.val())),0!=unit.parse(o.val())||invalid(o)||(i=!1),!i||!bridge.addRecipient(e.val(),n(this).find(".pay_to_label").val(),n(this).find(".narration").val(),unit.parse(o.val(),n(this).find(".unit").val()),t,n("#ring_size").val()))return!1}var t=s(),i=!0;bridge.userAction(["clearRecipients"]),bridge.info.options.AutoRingSize&&t>1&&r(),n("#send-balance").is(":visible")?n("#send-balance").each(e):n("div.recipient").each(e),i&&bridge.sendCoins(n("#coincontrol").is(":visible"),n("#change_address").val())&&a()},updateCoinControl:function(){if(n("#coincontrol").is(":visible")){for(var e=0,t=0;t<recipients;t++)e+=unit.parse(n("#amount"+t).val());bridge.updateCoinControlAmount(e)}},updateCoinControlInfo:function(e,t,i,o,a,r,c,s){n("#coincontrol").is(":visible")&&(n("#coincontrol_auto").toggle(0===e),n("#coincontrol_labels").toggle(e>0),e>0?(n("#coincontrol_quantity").text(e),n("#coincontrol_amount").text(unit.format(t)),n("#coincontrol_fee").text(unit.format(i)),n("#coincontrol_afterfee").text(unit.format(o)),n("#coincontrol_bytes").text("~"+a).css("color",a>1e4?"red":null),n("#coincontrol_priority").text(r).css("color",0==r.indexOf("low")?"red":null),n("#coincontrol_low").text(c).toggle(s).css("color","yes"==c?"red":null),n("#coincontrol_change").text(unit.format(s)).toggle(s),n("label[for='coincontrol_low'],label[for='coincontrol_change']").toggle(s)):(n("#coincontrol_quantity").text(""),n("#coincontrol_amount").text(""),n("#coincontrol_fee").text(""),n("#coincontrol_afterfee").text(""),n("#coincontrol_bytes").text(""),n("#coincontrol_priority").text(""),n("#coincontrol_low").text(""),n("#coincontrol_change").text("")))},changeTransactionType:c}}(jQuery);$(sendPage.init);
